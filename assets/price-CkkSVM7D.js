import{createComponent as C}from"solid-js/web";import{createContext as P,createSignal as x,createMemo as f,useContext as q,onMount as E,createEffect as N}from"solid-js";import{createStore as k}from"solid-js/store";import{g as I}from"./products-MGDi2K1K.js";import{i as g,u as v}from"./server-fns-runtime-DbMAENZJ.js";const J=(t,e)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const[r,o]of Object.entries(t))if(Object.hasOwn(e,r)===!1||o!==e[r])return!1;return!0},y=P(),L=t=>{const[e,r]=$([],1),[o,a]=x(void 0),c=g(async i=>{const b=Number(i.get("id")),h=Number(i.get("quantity")),u=await I(b);if(u===void 0)throw new Error("Product not found");const O=Object.fromEntries(u.properties.map(n=>[n.name,i.get(`p_${n.name}`)])),s={product:u,quantity:h,variation:O};a(s),await new Promise(n=>setTimeout(n,1e3));const l=e.find(n=>n.product.id===s.product.id&&J(n.variation,s.variation));if(l){const n=e.indexOf(l);r(n,"quantity",l.quantity+s.quantity)}else r(e.length,s)},"add"),m=g(async()=>{await new Promise(i=>setTimeout(i,1e3)),r([])},"clear"),p=v(c),S=v(m),d=f(()=>p.pending===!0?"adding":S.pending===!0?"clearing":"idle"),w=f(()=>{switch(d()){case"adding":return o();case"clearing":return;case"idle":return}});return C(y.Provider,{value:{items:e,current:w,state:d,add:c,clear:m},get children(){return t.children}})},R=()=>q(y);function $(t,e){const[r,o]=k(t),a=`cart.v${e}`;return E(()=>{if(console.log(localStorage[a]),localStorage[a])try{o(JSON.parse(localStorage[a]))}catch{o(()=>t)}N(()=>{localStorage[a]=JSON.stringify(r)})}),[r,o]}function Y(t){return[{EUR:"€",USD:"$",JPY:"¥"}[t.value.currency]," ",t.value.value]}export{L as C,Y as P,R as u};
